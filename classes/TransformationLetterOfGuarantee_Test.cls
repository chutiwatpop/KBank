@isTest
private class TransformationLetterOfGuarantee_Test {
    @isTest
    static void testLetterOfGuaranteeTransform_Positive() {
        SingleRequestMock fncResponse = new SingleRequestMock(200, 'Complete', lendingLGResponse(), null);
		SingleRequestMock lpmResponse = new SingleRequestMock(200, 'Complete', lpmResponse(), null);
		Map<String, HttpCalloutMock> endpointRespMap = new Map<String,HttpCalloutMock>();
        endpointRespMap.put(SME_CIRestWebservice.FNC_ENDPOINT, fncResponse);
        endpointRespMap.put(SME_CIRestWebservice.LPM_TDR_ENDPOINT, lpmResponse);
        HttpCalloutMock multiCalloutMock = new MultiRequestMock(endpointRespMap);
        Test.setMock(HttpCalloutMock.class, multiCalloutMock);

        Test.startTest();
        String cisId = '3281732';
        IProductUsageConfig productUsageConfig = new ProductUsageConfig();
        IProductUsageTransformation productUsageTransformer = new TransformationLetterOfGuarantee(cisId, 'LG', productUsageConfig);
		ProductUsageController.ProductUsageModel productUsages = productUsageTransformer.transform();
		ProductUsageController.ProductUsageTable productUsageTable = productUsages.productUsageTables.get('LG_0');
        Test.stopTest();

        system.assertEquals(6, productUsages.productUsageTables.size());
		system.assertEquals(0, productUsageTable.columnHeaders.size());
		system.assertEquals(2, productUsageTable.body.size());
        system.assertEquals(15, productUsageTable.body[0].size());
    }

    private static String lendingLGResponse() {
        String response = '{"dataResponse":{"Header":{"FCN_NM":"RS_FNC_SVC_AR_DTL","RQS_UNQ_ID":"2018-08-30T10:43:42+07:00","RSP_APL_ID":"655","RSP_UNQ_ID":"655_20180830_532ef9cfc5954dd892c658f35b0d1f68","RSP_TMS":"2018-08-30T10:43:43.752","RSP_CD":"00000","RSP_ST":"Success","TOT_RCRD":"23"},"Detail":{"IP_ID":"3281732","POS_DT":"2018-08-29","PCB_LMT_AR_LIST":{"PCB_LMT_AR_INF":[{"LMT_AR_ID":"03716280009L1","LMT_AR_ID_ENCODED":"KQOTaUINjs4GyVSaP9N+kg==","ORIG_AR_ID":"100000373308","UPR_LMT_AR_ID":"000000000000","ROOT_LMT_AR_ID":"03716280009L1","LMT_LVL_IND":"1","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"","CTR_DT":"1993-01-12","EFF_DT":"1993-01-12","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"3","PD_GRP":"COM","PD_TP_CD":"8003","PD_SUB_TP_CD":"23001","MKT_CD":"0001","COA_PD_FTR_CD":"160183002","SETUP_LMT_AMT":"113000.00","CTR_LMT_AMT":"113000.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"0.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":null},{"LMT_AR_ID":"03716210011L12","LMT_AR_ID_ENCODED":"5oSSPvCsR8BWMLRdB2DLdA==","ORIG_AR_ID":"100001552540","UPR_LMT_AR_ID":"03716210014L1","ROOT_LMT_AR_ID":"03716210009L1","LMT_LVL_IND":"2","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"002020399","CTR_DT":"1994-02-18","EFF_DT":"1994-02-18","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"3","PD_GRP":"COM","PD_TP_CD":"8030","PD_SUB_TP_CD":"33005","MKT_CD":"0001","COA_PD_FTR_CD":"160177001","SETUP_LMT_AMT":"142250.00","CTR_LMT_AMT":"142250.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"142250.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":null},{"LMT_AR_ID":"03716210014L1","LMT_AR_ID_ENCODED":"Jka1MWJfrMy8YCdEbtpwQQ==","ORIG_AR_ID":"100000373340","UPR_LMT_AR_ID":"03716210009L1","ROOT_LMT_AR_ID":"03716210009L1","LMT_LVL_IND":"1","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"","CTR_DT":"1995-04-11","EFF_DT":"1995-04-11","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"3","PD_GRP":"COM","PD_TP_CD":"8003","PD_SUB_TP_CD":"23001","MKT_CD":"0001","COA_PD_FTR_CD":"160183002","SETUP_LMT_AMT":"2000000.00","CTR_LMT_AMT":"2000000.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"0.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":null},{"LMT_AR_ID":"03716210009L1","LMT_AR_ID_ENCODED":"KQOTaUINjw6GyVSaP9N+kg==","ORIG_AR_ID":"100000373308","UPR_LMT_AR_ID":"000000000000","ROOT_LMT_AR_ID":"03716210009L1","LMT_LVL_IND":"1","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"","CTR_DT":"1993-01-12","EFF_DT":"1993-01-12","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"3","PD_GRP":"COM","PD_TP_CD":"8003","PD_SUB_TP_CD":"23001","MKT_CD":"0001","COA_PD_FTR_CD":"160183002","SETUP_LMT_AMT":"113000.00","CTR_LMT_AMT":"113000.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"0.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":null},{"LMT_AR_ID":"03716210010L1","LMT_AR_ID_ENCODED":"R9/uBl+ZOKJaJp096ga9Sw==","ORIG_AR_ID":"100000373316","UPR_LMT_AR_ID":"03716210009L1","ROOT_LMT_AR_ID":"03716210009L1","LMT_LVL_IND":"1","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"","CTR_DT":"1993-01-12","EFF_DT":"1993-01-12","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"3","PD_GRP":"COM","PD_TP_CD":"8003","PD_SUB_TP_CD":"23001","MKT_CD":"0001","COA_PD_FTR_CD":"160183002","SETUP_LMT_AMT":"141000.00","CTR_LMT_AMT":"141000.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"0.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":null},{"LMT_AR_ID":"03716210014L12","LMT_AR_ID_ENCODED":"5yOPma3xPpN7uGRFK0JGoA==","ORIG_AR_ID":"100001552567","UPR_LMT_AR_ID":"03716210010L1","ROOT_LMT_AR_ID":"03716210009L1","LMT_LVL_IND":"2","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"002020399","CTR_DT":"1995-04-11","EFF_DT":"1995-04-11","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"3","PD_GRP":"COM","PD_TP_CD":"8030","PD_SUB_TP_CD":"33005","MKT_CD":"0001","COA_PD_FTR_CD":"160177001","SETUP_LMT_AMT":"2000000.00","CTR_LMT_AMT":"2000000.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"2000000.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":{"PCB_AR_INF":[{"AR_ID":"2634200095","AR_ID_ENCODED":"UVbjnYjCRgUQyd5UzvG8YA==","ORIG_AR_ID":"100009687186","LMT_AR_ID":"03716210014L12","ROOT_LMT_AR_ID":"03716210009L1","AR_PPS_TP_CD":"","KBNK_IDY_CL_CD":"002020399","OPN_DT":"1995-04-11","EFF_DT":"1995-04-11","CTR_DT":"1995-04-11","MAT_DT":"2113-12-31","CLS_DT":"","CTR_AR_TERM":"360","CTR_AR_TERM_UOM_TP_CD":"D","PD_GRP":"COM","PD_TP_CD":"8300","PD_SUB_TP_CD":"43005","MKT_CD":"0001","COA_PD_FTR_CD":"160177001","LPM_CLSS":"1","LMT_AMT":"2000000.00","PNP_AMT":"2000000.00","ACR_INT_AMT":"0.00","RVRS_INT_AMT":"0.00","RVRS_F":"0","RVRS_DT":"","MEMO_ACR_INT_AMT":"0.00","OTSND_BAL":"2000000.00","TOT_NO_INSTL":"0","EFF_RATE_PCT":"0.00000","EFF_INT_RATE_TP_CD":"","EFF_SPRD_RATE_PCT":"0.00000","ORIG_ADV_AR_ID":null,"AR_NM_TH":"พิเชษฐ์พงษ์ ไชยรัมภ์","AR_NM_EN":"PICHETPONG CHAIRUM","PYMT_TP_CD":"2","PYMT_DUE_DT":"1840-12-30","LAST_PYMT_DT":"2018-04-11","DDC_AR_ID":"2261000191","DDC_INT_TP_CD":"0","FEE_RATE_PCT":"1.00000","CMSN_TP_CD":"1","UPD_FEE_AMT":"0.00","PCB_AR_IP_LIST":{"PCB_AR_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PYMT_SHD_LIST":{"PYMT_SHD_INF":[{"CNDT_STRT_DT":"","PYMT_MTH_CD":"","PYMT_MTH_DSC":"","PNP_PYMT_FRQ_CYC_CD":"","PNP_PYMT_FRQ_UNIT_CD":"","PNP_PYMT_FRQ_TP_CD":"","PNP_PYMT_FRQ_DAY_CD":"","PNP_AMT":"","INT_PYMT_FRQ_CYC_CD":"","INT_PYMT_FRQ_UNIT_CD":"","INT_PYMT_FRQ_TP_CD":"","INT_PYMT_FRQ_DAY_CD":"","INT_AMT":""}]}}]}},{"LMT_AR_ID":"226334200027","LMT_AR_ID_ENCODED":"Optkn3p5OY7Q8t6Wq71Aog==","ORIG_AR_ID":"100009687119","UPR_LMT_AR_ID":"000000000000","ROOT_LMT_AR_ID":"226334200027","LMT_LVL_IND":"3","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"002020399","CTR_DT":"1990-08-06","EFF_DT":"1990-08-06","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"0","PD_GRP":"COM","PD_TP_CD":"8300","PD_SUB_TP_CD":"43005","MKT_CD":"0001","COA_PD_FTR_CD":"160177001","SETUP_LMT_AMT":"0.00","CTR_LMT_AMT":"0.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"0.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":{"PCB_AR_INF":[{"AR_ID":"2633200027","AR_ID_ENCODED":"Optkn3p5OY7Q8t6Wq71Aog==","ORIG_AR_ID":"100009687119","LMT_AR_ID":"226334200027","ROOT_LMT_AR_ID":"226334200027","AR_PPS_TP_CD":"","KBNK_IDY_CL_CD":"002020399","OPN_DT":"1990-08-06","EFF_DT":"1990-08-06","CTR_DT":"1990-08-06","MAT_DT":"2113-12-31","CLS_DT":"","CTR_AR_TERM":"360","CTR_AR_TERM_UOM_TP_CD":"D","PD_GRP":"COM","PD_TP_CD":"8300","PD_SUB_TP_CD":"43005","MKT_CD":"0001","COA_PD_FTR_CD":"160177001","LPM_CLSS":"1","LMT_AMT":"150000.00","PNP_AMT":"150000.00","ACR_INT_AMT":"0.00","RVRS_INT_AMT":"0.00","RVRS_F":"0","RVRS_DT":"","MEMO_ACR_INT_AMT":"0.00","OTSND_BAL":"150000.00","TOT_NO_INSTL":"0","EFF_RATE_PCT":"0.00000","EFF_INT_RATE_TP_CD":"","EFF_SPRD_RATE_PCT":"0.00000","ORIG_ADV_AR_ID":null,"AR_NM_TH":"พิเชษฐ์พงษ์ ไชยรัมภ์","AR_NM_EN":"PICHETPONG CHAIRUM","PYMT_TP_CD":"2","PYMT_DUE_DT":"1840-12-30","LAST_PYMT_DT":"2018-08-06","DDC_AR_ID":"2261000191","DDC_INT_TP_CD":"0","FEE_RATE_PCT":"1.00000","CMSN_TP_CD":"1","UPD_FEE_AMT":"0.00","PCB_AR_IP_LIST":{"PCB_AR_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PYMT_SHD_LIST":{"PYMT_SHD_INF":[{"CNDT_STRT_DT":"","PYMT_MTH_CD":"","PYMT_MTH_DSC":"","PNP_PYMT_FRQ_CYC_CD":"","PNP_PYMT_FRQ_UNIT_CD":"","PNP_PYMT_FRQ_TP_CD":"","PNP_PYMT_FRQ_DAY_CD":"","PNP_AMT":"","INT_PYMT_FRQ_CYC_CD":"","INT_PYMT_FRQ_UNIT_CD":"","INT_PYMT_FRQ_TP_CD":"","INT_PYMT_FRQ_DAY_CD":"","INT_AMT":""}]}}]}},{"LMT_AR_ID":"037244310011L12","LMT_AR_ID_ENCODED":"5yOPmf3xPpBWMGRFK1JGoA==","ORIG_AR_ID":"100001552540","UPR_LMT_AR_ID":"03716210014L1","ROOT_LMT_AR_ID":"03716210009L1","LMT_LVL_IND":"2","LMT_AR_PPS_TP_CD":"","LMT_KBNK_IDY_CL_CD":"002020399","CTR_DT":"1994-02-18","EFF_DT":"1994-02-18","MAT_DT":"2113-12-31","CLS_DT":{"@nil":"false"},"DCN_TP_CD":"0","LMT_TP_CD":"3","PD_GRP":"COM","PD_TP_CD":"8030","PD_SUB_TP_CD":"33005","MKT_CD":"0001","COA_PD_FTR_CD":"160177001","SETUP_LMT_AMT":"142250.00","CTR_LMT_AMT":"142250.00","UNUSED_LMT_AMT":"0.00","HOLD_AMT":"0.00","AVL_LMT_AMT":"0.00","TOT_LI_AMT":"142250.00","PCB_LMT_IP_LIST":{"PCB_LMT_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PCB_AR_LIST":{"PCB_AR_INF":[{"AR_ID":"2634200027","AR_ID_ENCODED":"5yOPmf3xPpN7uGRFK1JGoA==","ORIG_AR_ID":"100001552540","LMT_AR_ID":"037244310011L12","ROOT_LMT_AR_ID":"03716210009L1","AR_PPS_TP_CD":"","KBNK_IDY_CL_CD":"002020399","OPN_DT":"1990-08-06","EFF_DT":"1990-08-06","CTR_DT":"1990-08-06","MAT_DT":"2113-12-31","CLS_DT":"","CTR_AR_TERM":"360","CTR_AR_TERM_UOM_TP_CD":"D","PD_GRP":"COM","PD_TP_CD":"8300","PD_SUB_TP_CD":"43005","MKT_CD":"0001","COA_PD_FTR_CD":"160177001","LPM_CLSS":"1","LMT_AMT":"150000.00","PNP_AMT":"150000.00","ACR_INT_AMT":"0.00","RVRS_INT_AMT":"0.00","RVRS_F":"0","RVRS_DT":"","MEMO_ACR_INT_AMT":"0.00","OTSND_BAL":"null","TOT_NO_INSTL":"0","EFF_RATE_PCT":"0.00000","EFF_INT_RATE_TP_CD":"","EFF_SPRD_RATE_PCT":"0.00000","ORIG_ADV_AR_ID":null,"AR_NM_TH":"พิเชษฐ์พงษ์ ไชยรัมภ์","AR_NM_EN":"PICHETPONG CHAIRUM","PYMT_TP_CD":"2","PYMT_DUE_DT":"1840-12-30","LAST_PYMT_DT":"2018-08-06","DDC_AR_ID":"2261000191","DDC_INT_TP_CD":"0","FEE_RATE_PCT":"1.00000","CMSN_TP_CD":"1","UPD_FEE_AMT":"0.00","PCB_AR_IP_LIST":{"PCB_AR_IP_INF":[{"IP_ID":"3281732","AR_OWN_TP_CD":"2"}]},"PYMT_SHD_LIST":{"PYMT_SHD_INF":[{"CNDT_STRT_DT":"","PYMT_MTH_CD":"","PYMT_MTH_DSC":"","PNP_PYMT_FRQ_CYC_CD":"","PNP_PYMT_FRQ_UNIT_CD":"","PNP_PYMT_FRQ_TP_CD":"","PNP_PYMT_FRQ_DAY_CD":"","PNP_AMT":"","INT_PYMT_FRQ_CYC_CD":"","INT_PYMT_FRQ_UNIT_CD":"","INT_PYMT_FRQ_TP_CD":"","INT_PYMT_FRQ_DAY_CD":"","INT_AMT":""}]}}]}}]}}}}';
        return response;
    }

    private static String lpmResponse() {
        String response = '{"dataResponse":{"Header":{"FCN_NM":"RS_LPM_TDR_DPD","RQS_UNQ_ID":"","RSP_APL_ID":"655","RSP_UNQ_ID":"655_20180821_e80c393cdf544c1b9857091c76c595e5","RSP_TMS":"2018-08-21T18:08:55.692","RSP_CD":"00000","RSP_ST":"Success","TOT_RCRD":"175"},"Detail":{"IP_ID":"454059","LPM_DTL_LIST":{"LPM_DTL_INF":[{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"KQOTaUINjw6GyVSaP9N+kg==","DLQ_DYS":"1","TDR_F":"Y"},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"Jka1MWJfrMy8YCdEbtpwQQ==","DLQ_DYS":"3","TDR_F":"N"},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"R9/uBl+ZOKJaJp096ga9Sw==","DLQ_DYS":"2","TDR_F":""},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"5oSSPvCsR8BWMLRdB2DLdA==","DLQ_DYS":"1","TDR_F":"N"},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"5yOPma3xPpN7uGRFK0JGoA==","DLQ_DYS":"","TDR_F":"N"},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"5yOPmf3xPpN7uGRFK1JGoA==","DLQ_DYS":"3","TDR_F":"Y"},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"5yOPmf3xPpBWMGRFK1JGoA==","DLQ_DYS":"","TDR_F":""},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"Optkn3p5OY7Q8t6Wq71Aog==","DLQ_DYS":"2","TDR_F":"Y"},{"POS_DT":"2018-05-31","LPM_CST_ID":"810306","AR_ID_ENCODED":"UVbjnYjCRgUQyd5UzvG8YA==","DLQ_DYS":"2","TDR_F":"N"}]}}}}';
        return response;
    }
}