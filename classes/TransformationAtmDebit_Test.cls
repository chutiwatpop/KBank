@isTest
private class TransformationAtmDebit_Test
{
	@isTest
	static void itShouldReturnAtmWhenWebServiceReturnData()
	{
		// Given
		HttpCalloutMock atmDcCardResponse = new SingleRequestMock(200, 'Complete', atmCardResponse(), null);
		Test.setMock(HttpCalloutMock.class, atmDcCardResponse);
		IProductUsageConfig productUsageConfig = new ProductUsageConfig();
		IProductUsageTransformation atmTransformer = new TransformationAtmDebit('1626994', 'ATM', productUsageConfig);

		// When
		Test.startTest();
		ProductUsageController.ProductUsageModel productUsageInfo = atmTransformer.transform();
		Test.stopTest();

		// Then
		system.assertEquals(7, productUsageInfo.productUsageTables.get('ATM_0').body.size());
		system.assertEquals('ค้าง', productUsageInfo.productUsageTables.get('ATM_0').body.get(0).get(9));
		system.assertEquals('ไม่ค้าง', productUsageInfo.productUsageTables.get('ATM_0').body.get(2).get(9));
		system.assertEquals('Active', productUsageInfo.productUsageTables.get('ATM_0').body.get(0).get(2));
		system.assertEquals('Lost card', productUsageInfo.productUsageTables.get('ATM_0').body.get(4).get(2));
		system.assertEquals('Delete card', productUsageInfo.productUsageTables.get('ATM_0').body.get(5).get(2));
		system.assertEquals('Other Status', productUsageInfo.productUsageTables.get('ATM_0').body.get(6).get(2));
	}

	private static String atmCardResponse() {
		String response = '{"dataResponse":{"Header":{"FCN_NM":"RS_DC_CARD","RQS_UNQ_ID":"?","RSP_APL_ID":"655","RSP_UNQ_ID":"655_20180806_cc413171297e4b8781269d28de3181ca","RSP_TMS":"2018-08-06T18:31:09.057","RSP_CD":"00000","RSP_ST":"Success","TOT_RCRD":"3"},"Detail":{"IP_ID":"1319526","POS_DT":"2018-06-14","DC_DTL_LIST":{"DC_DTL_INF":[{"CARD_NO":"0004018000280451","ST_CD":"00","TOT_USED_CNT":"103","CA_AR_ID":"2511012778","CA_DOMC_BR_NO":"0251","CA_DOMC_BR_NM":"สาขาพุนพิน","SA_AR_ID":"","SA_DOMC_BR_NO":"0000","SA_DOMC_BR_NM":"","EXP_YR_MO":"2006","CARD_HLDR_NM":"PIENGBULAN PRATIED","IVR_BAD_PIN_CNT":"0","ISSU_DT":"2000-07-05","RSET_PIN_CNT":"0","CARD_BR_NO":"0251","CRT_DT":"2000-06-21","LAST_MNT_DT":"2000-07-05","EDC_LAST_USED_DT":"","EDC_TOT_AMT":"0.00","TO_BR_NO":"0000","CNCL_DT":"","CNCL_TM":"00:00:00","ST_UDT_TM":"00:00:00","INTR_BNK_CNT":"0","INTR_BNK_LAST_USED_DT":"2002-09-09","UDT_F_DT":"2013-08-03","ANUL_FEE_F":"1","ANUL_FEE_CNT":"9","ANUL_FEE_AMT":"1350.00","ANUL_FEE_PAID_DT":"","INN_PRCH_RGST_F":"","EDC_BAD_PIN_CNT":"0","INN_PRCH_AMT":"0.00","INN_PRCH_LMT_AMT":"50000.00","WD_LMT_AMT":"50000.00","WD_LMT_UDT_DT":"","WD_LMT_UDT_TM":"00:00:00","TFR_LMT_AMT":"200000.00","TFR_LMT_UDT_DT":"","TFR_LMT_UDT_TM":"00:00:00","CARD_TP_CD":"50000","CARD_TP_DSC":"E CASH","DUE_YR_MO":"1407","OLD_CARD_NO":"","INTR_BNK_CALC_FEE_DT":"2002-09-09","INTR_BNK_CALC_FEE_CNT":"2","CHIP_CARD_F":"N","CHIP_CARD_CNT":"0"},{"CARD_NO":"4315080004069989","ST_CD":"02","TOT_USED_CNT":"128","CA_AR_ID":"2511012778","CA_DOMC_BR_NO":"0251","CA_DOMC_BR_NM":"สาขาพุนพิน","SA_AR_ID":"","SA_DOMC_BR_NO":"0000","SA_DOMC_BR_NM":"","EXP_YR_MO":"2209","CARD_HLDR_NM":"SUPAVAD SAILIAM","IVR_BAD_PIN_CNT":"0","ISSU_DT":"2002-09-20","RSET_PIN_CNT":"0","CARD_BR_NO":"0251","CRT_DT":"2002-09-04","LAST_MNT_DT":"2002-09-20","EDC_LAST_USED_DT":"2010-03-03","EDC_TOT_AMT":"44129.70","TO_BR_NO":"0025","CNCL_DT":"","CNCL_TM":"00:00:00","ST_UDT_TM":"00:00:00","INTR_BNK_CNT":"0","INTR_BNK_LAST_USED_DT":"2003-08-21","UDT_F_DT":"2013-10-05","ANUL_FEE_F":"1","ANUL_FEE_CNT":"9","ANUL_FEE_AMT":"1800.00","ANUL_FEE_PAID_DT":"","INN_PRCH_RGST_F":"","EDC_BAD_PIN_CNT":"0","INN_PRCH_AMT":"0.00","INN_PRCH_LMT_AMT":"100000.00","WD_LMT_AMT":"50000.00","WD_LMT_UDT_DT":"","WD_LMT_UDT_TM":"00:00:00","TFR_LMT_AMT":"200000.00","TFR_LMT_UDT_DT":"","TFR_LMT_UDT_TM":"00:00:00","CARD_TP_CD":"00000","CARD_TP_DSC":"FLEX-C STANDARD","DUE_YR_MO":"1409","OLD_CARD_NO":"","INTR_BNK_CALC_FEE_DT":"2003-08-21","INTR_BNK_CALC_FEE_CNT":"1","CHIP_CARD_F":"N","CHIP_CARD_CNT":"0"},{"CARD_NO":"4283800518291789","ST_CD":"04","TOT_USED_CNT":"3","CA_AR_ID":"","CA_DOMC_BR_NO":"0000","CA_DOMC_BR_NM":"","SA_AR_ID":"9042177986","SA_DOMC_BR_NO":"0904","SA_DOMC_BR_NM":"","EXP_YR_MO":"1903","CARD_HLDR_NM":"BOORACHART THEERAPHANIDAKORN","IVR_BAD_PIN_CNT":"0","ISSU_DT":"2014-03-12","RSET_PIN_CNT":"0","CARD_BR_NO":"0652","CRT_DT":"2014-03-04","LAST_MNT_DT":"2014-03-12","EDC_LAST_USED_DT":"","EDC_TOT_AMT":"0.00","TO_BR_NO":"0000","CNCL_DT":"","CNCL_TM":"00:00:00","ST_UDT_TM":"00:00:00","INTR_BNK_CNT":"0","INTR_BNK_LAST_USED_DT":"","UDT_F_DT":"","ANUL_FEE_F":"0","ANUL_FEE_CNT":"0","ANUL_FEE_AMT":"0.00","ANUL_FEE_PAID_DT":"","INN_PRCH_RGST_F":"N","EDC_BAD_PIN_CNT":"0","INN_PRCH_AMT":"0.00","INN_PRCH_LMT_AMT":"20000.00","WD_LMT_AMT":"200000.00","WD_LMT_UDT_DT":"2014-03-12","WD_LMT_UDT_TM":"19:00:33","TFR_LMT_AMT":"1000000.00","TFR_LMT_UDT_DT":"2014-03-12","TFR_LMT_UDT_TM":"18:59:48","CARD_TP_CD":"20005","CARD_TP_DSC":"K-MY SPECIAL DEBIT","DUE_YR_MO":"1503","OLD_CARD_NO":"","INTR_BNK_CALC_FEE_DT":"","INTR_BNK_CALC_FEE_CNT":"0","CHIP_CARD_F":"N","CHIP_CARD_CNT":"0"},{"CARD_NO":"4283800518291789","ST_CD":"20","TOT_USED_CNT":"3","CA_AR_ID":"","CA_DOMC_BR_NO":"0000","CA_DOMC_BR_NM":"","SA_AR_ID":"9042177986","SA_DOMC_BR_NO":"0904","SA_DOMC_BR_NM":"","EXP_YR_MO":"1903","CARD_HLDR_NM":"BOORACHART THEERAPHANIDAKORN","IVR_BAD_PIN_CNT":"0","ISSU_DT":"2014-03-12","RSET_PIN_CNT":"0","CARD_BR_NO":"0652","CRT_DT":"2014-03-04","LAST_MNT_DT":"2014-03-12","EDC_LAST_USED_DT":"","EDC_TOT_AMT":"0.00","TO_BR_NO":"0000","CNCL_DT":"","CNCL_TM":"00:00:00","ST_UDT_TM":"00:00:00","INTR_BNK_CNT":"0","INTR_BNK_LAST_USED_DT":"","UDT_F_DT":"","ANUL_FEE_F":"0","ANUL_FEE_CNT":"0","ANUL_FEE_AMT":"0.00","ANUL_FEE_PAID_DT":"","INN_PRCH_RGST_F":"N","EDC_BAD_PIN_CNT":"0","INN_PRCH_AMT":"0.00","INN_PRCH_LMT_AMT":"20000.00","WD_LMT_AMT":"200000.00","WD_LMT_UDT_DT":"2014-03-12","WD_LMT_UDT_TM":"19:00:33","TFR_LMT_AMT":"1000000.00","TFR_LMT_UDT_DT":"2014-03-12","TFR_LMT_UDT_TM":"18:59:48","CARD_TP_CD":"20005","CARD_TP_DSC":"K-MY SPECIAL DEBIT","DUE_YR_MO":"1503","OLD_CARD_NO":"","INTR_BNK_CALC_FEE_DT":"","INTR_BNK_CALC_FEE_CNT":"0","CHIP_CARD_F":"N","CHIP_CARD_CNT":"0"},{"CARD_NO":"4283800518291789","ST_CD":"40","TOT_USED_CNT":"3","CA_AR_ID":"","CA_DOMC_BR_NO":"0000","CA_DOMC_BR_NM":"","SA_AR_ID":"9042177986","SA_DOMC_BR_NO":"0904","SA_DOMC_BR_NM":"","EXP_YR_MO":"1903","CARD_HLDR_NM":"BOORACHART THEERAPHANIDAKORN","IVR_BAD_PIN_CNT":"0","ISSU_DT":"2014-03-12","RSET_PIN_CNT":"0","CARD_BR_NO":"0652","CRT_DT":"2014-03-04","LAST_MNT_DT":"2014-03-12","EDC_LAST_USED_DT":"","EDC_TOT_AMT":"0.00","TO_BR_NO":"0000","CNCL_DT":"","CNCL_TM":"00:00:00","ST_UDT_TM":"00:00:00","INTR_BNK_CNT":"0","INTR_BNK_LAST_USED_DT":"","UDT_F_DT":"","ANUL_FEE_F":"0","ANUL_FEE_CNT":"0","ANUL_FEE_AMT":"0.00","ANUL_FEE_PAID_DT":"","INN_PRCH_RGST_F":"N","EDC_BAD_PIN_CNT":"0","INN_PRCH_AMT":"0.00","INN_PRCH_LMT_AMT":"20000.00","WD_LMT_AMT":"200000.00","WD_LMT_UDT_DT":"2014-03-12","WD_LMT_UDT_TM":"19:00:33","TFR_LMT_AMT":"1000000.00","TFR_LMT_UDT_DT":"2014-03-12","TFR_LMT_UDT_TM":"18:59:48","CARD_TP_CD":"20005","CARD_TP_DSC":"K-MY SPECIAL DEBIT","DUE_YR_MO":"1503","OLD_CARD_NO":"","INTR_BNK_CALC_FEE_DT":"","INTR_BNK_CALC_FEE_CNT":"0","CHIP_CARD_F":"N","CHIP_CARD_CNT":"0"},{"CARD_NO":"4283800518291789","ST_CD":"80","TOT_USED_CNT":"3","CA_AR_ID":"","CA_DOMC_BR_NO":"0000","CA_DOMC_BR_NM":"","SA_AR_ID":"9042177986","SA_DOMC_BR_NO":"0904","SA_DOMC_BR_NM":"","EXP_YR_MO":"1903","CARD_HLDR_NM":"BOORACHART THEERAPHANIDAKORN","IVR_BAD_PIN_CNT":"0","ISSU_DT":"2014-03-12","RSET_PIN_CNT":"0","CARD_BR_NO":"0652","CRT_DT":"2014-03-04","LAST_MNT_DT":"2014-03-12","EDC_LAST_USED_DT":"","EDC_TOT_AMT":"0.00","TO_BR_NO":"0000","CNCL_DT":"","CNCL_TM":"00:00:00","ST_UDT_TM":"00:00:00","INTR_BNK_CNT":"0","INTR_BNK_LAST_USED_DT":"","UDT_F_DT":"","ANUL_FEE_F":"0","ANUL_FEE_CNT":"0","ANUL_FEE_AMT":"0.00","ANUL_FEE_PAID_DT":"","INN_PRCH_RGST_F":"N","EDC_BAD_PIN_CNT":"0","INN_PRCH_AMT":"0.00","INN_PRCH_LMT_AMT":"20000.00","WD_LMT_AMT":"200000.00","WD_LMT_UDT_DT":"2014-03-12","WD_LMT_UDT_TM":"19:00:33","TFR_LMT_AMT":"1000000.00","TFR_LMT_UDT_DT":"2014-03-12","TFR_LMT_UDT_TM":"18:59:48","CARD_TP_CD":"20005","CARD_TP_DSC":"K-MY SPECIAL DEBIT","DUE_YR_MO":"1503","OLD_CARD_NO":"","INTR_BNK_CALC_FEE_DT":"","INTR_BNK_CALC_FEE_CNT":"0","CHIP_CARD_F":"N","CHIP_CARD_CNT":"0"},{"CARD_NO":"4283800518291789","ST_CD":"99","TOT_USED_CNT":"3","CA_AR_ID":"","CA_DOMC_BR_NO":"0000","CA_DOMC_BR_NM":"","SA_AR_ID":"9042177986","SA_DOMC_BR_NO":"0904","SA_DOMC_BR_NM":"","EXP_YR_MO":"1903","CARD_HLDR_NM":"BOORACHART THEERAPHANIDAKORN","IVR_BAD_PIN_CNT":"0","ISSU_DT":"2014-03-12","RSET_PIN_CNT":"0","CARD_BR_NO":"0652","CRT_DT":"2014-03-04","LAST_MNT_DT":"2014-03-12","EDC_LAST_USED_DT":"","EDC_TOT_AMT":"0.00","TO_BR_NO":"0000","CNCL_DT":"","CNCL_TM":"00:00:00","ST_UDT_TM":"00:00:00","INTR_BNK_CNT":"0","INTR_BNK_LAST_USED_DT":"","UDT_F_DT":"","ANUL_FEE_F":"0","ANUL_FEE_CNT":"0","ANUL_FEE_AMT":"0.00","ANUL_FEE_PAID_DT":"","INN_PRCH_RGST_F":"N","EDC_BAD_PIN_CNT":"0","INN_PRCH_AMT":"0.00","INN_PRCH_LMT_AMT":"20000.00","WD_LMT_AMT":"200000.00","WD_LMT_UDT_DT":"2014-03-12","WD_LMT_UDT_TM":"19:00:33","TFR_LMT_AMT":"1000000.00","TFR_LMT_UDT_DT":"2014-03-12","TFR_LMT_UDT_TM":"18:59:48","CARD_TP_CD":"20005","CARD_TP_DSC":"K-MY SPECIAL DEBIT","DUE_YR_MO":"1503","OLD_CARD_NO":"","INTR_BNK_CALC_FEE_DT":"","INTR_BNK_CALC_FEE_CNT":"0","CHIP_CARD_F":"N","CHIP_CARD_CNT":"0"}]}}}}';
		return response;
	}
}