@isTest
private class TransformationFCD_Test {
    @isTest
	static void test_FCDtransform_Positive() {
		HttpCalloutMock custWealthResponse = new SingleRequestMock(200, 'Complete', fcdResponse(), null);
        Test.setMock(HttpCalloutMock.class, custWealthResponse);

		Test.startTest();
		String cisId = '114';
		IProductUsageConfig productUsageConfig = new ProductUsageConfig();
		IProductUsageTransformation productUsageTransformer = new TransformationFCD(cisId, 'FCD', productUsageConfig);
		ProductUsageController.ProductUsageModel productUsages = productUsageTransformer.transform();
		ProductUsageController.ProductUsageTable productUsageTable = productUsages.productUsageTables.get('FCD_0');
		ProductUsageController.ProductUsageTable productUsageTableSub1 = productUsages.productUsageTables.get('FCD_xxxxx0851x_2_0');
		Test.stopTest();

		system.assertEquals(4, productUsages.productUsageTables.size());
		system.assertEquals(0, productUsageTable.columnHeaders.size());
		system.assertEquals(8, productUsageTable.body.size());
        system.assertEquals(19, productUsageTable.body[0].size());
		system.assertEquals(19, productUsageTable.body[3].size());
		system.assertEquals(7, productUsageTableSub1.body.size());
		system.assertEquals(18, productUsageTableSub1.body[1].size());
		system.assertEquals(18, productUsageTableSub1.body[5].size());
		system.assertEquals('001', productUsageTableSub1.body[0][0]);
		system.assertEquals('002', productUsageTableSub1.body[1][0]);
		system.assertEquals('003', productUsageTableSub1.body[2][0]);
		system.assertEquals('004', productUsageTableSub1.body[3][0]);
		system.assertEquals('005', productUsageTableSub1.body[4][0]);
		system.assertEquals('006', productUsageTableSub1.body[5][0]);
		system.assertEquals('007', productUsageTableSub1.body[6][0]);
    }

	private static String fcdResponse() {
		String response = '{"dataResponse":{"Header":{"FCN_NM":"RS_FCD_AR_DTL","RQS_UNQ_ID":"?","RSP_APL_ID":"655","RSP_UNQ_ID":"655_20180921_dd0937f2b96c481b8a273ef921a3519f","RSP_TMS":"2018-09-21T11:29:57.508","RSP_CD":"00000","RSP_ST":"Success","TOT_RCRD":"21"},"Detail":{"IP_ID":"114","AR_DTL_LIST":{"FCD_AR_DTL_INF":[{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"001","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"1998.76","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"66168.350172000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.09000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"2018-09-10","MAT_DT":"2018-10-10","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"002","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"3003.11","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"99417.055617000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.09000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"2018-09-10","MAT_DT":"2018-10-10","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"006","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-06","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"670.24","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"22188.094128000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.09000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"2018-09-14","MAT_DT":"2018-10-16","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"003","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"3004.11","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"99450.160317000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.09000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"2018-09-10","MAT_DT":"2018-10-10","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"005","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-06","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"4003.50","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"132534.666450000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.09000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"2018-09-14","MAT_DT":"2018-10-16","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"004","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-06","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"4002.50","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"132501.561750000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.09000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"2018-09-14","MAT_DT":"2018-10-16","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"007","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-06","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"1113.42","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"36859.435074000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.09000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"2018-09-14","MAT_DT":"2018-10-16","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0851x","AR_ID_ENCODED":"JflYjFpwVAW7cpkEG0bLtg==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"99","AR_TERM_UOM_TP_CD":"Y","CCY_CD":"USD","CCY_OTSND_BAL":"17795.64","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"589119.323508000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.00000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2114-10-15","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0838x","AR_ID_ENCODED":"NGz2ELFL7cSEpvYPfyxAtg==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DSFCD","PD_TP_CD":"2101","AR_TERM":"0","AR_TERM_UOM_TP_CD":"","CCY_CD":"USD","CCY_OTSND_BAL":"4252.22","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"140768.467434000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.14000","EFF_INT_RATE_TP_ID":"","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0849x","AR_ID_ENCODED":"P/kLW88wksocHuCwLAUHeg==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"99","AR_TERM_UOM_TP_CD":"Y","CCY_CD":"IDR","CCY_OTSND_BAL":"16296.00","MID_RATE":"0.0032750","CNVR_OTSND_BAL":"53.369400000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.00000","EFF_INT_RATE_TP_ID":"CDIDR","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2114-10-15","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0849x","AR_ID_ENCODED":"P/kLW88wksocHuCwLAUHeg==","SUB_AR":"001","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"IDR","CCY_OTSND_BAL":"0.00","MID_RATE":"0.0032750","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"4.00000","EFF_INT_RATE_TP_ID":"CDIDR","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2018-04-05","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0849x","AR_ID_ENCODED":"P/kLW88wksocHuCwLAUHeg==","SUB_AR":"002","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"IDR","CCY_OTSND_BAL":"0.00","MID_RATE":"0.0032750","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"4.00000","EFF_INT_RATE_TP_ID":"CDIDR","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2018-04-05","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0849x","AR_ID_ENCODED":"P/kLW88wksocHuCwLAUHeg==","SUB_AR":"003","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"IDR","CCY_OTSND_BAL":"0.00","MID_RATE":"0.0032750","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"4.00000","EFF_INT_RATE_TP_ID":"CDIDR","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2018-04-05","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0849x","AR_ID_ENCODED":"P/kLW88wksocHuCwLAUHeg==","SUB_AR":"004","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"IDR","CCY_OTSND_BAL":"0.00","MID_RATE":"0.0032750","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"4.00000","EFF_INT_RATE_TP_ID":"CDIDR","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2018-04-05","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0849x","AR_ID_ENCODED":"P/kLW88wksocHuCwLAUHeg==","SUB_AR":"005","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-06","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"IDR","CCY_OTSND_BAL":"0.00","MID_RATE":"0.0032750","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"4.00000","EFF_INT_RATE_TP_ID":"CDIDR","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2018-04-09","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0845x","AR_ID_ENCODED":"lkw3lc5ZONz26q+1cgbaIg==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"99","AR_TERM_UOM_TP_CD":"Y","CCY_CD":"USD","CCY_OTSND_BAL":"556.00","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"18406.213200000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.00000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2114-10-15","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0839x","AR_ID_ENCODED":"Tz6pJoCgS79c8zGS9iGoew==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"2101","AR_TERM":"0","AR_TERM_UOM_TP_CD":"","CCY_CD":"IDR","CCY_OTSND_BAL":"11687.40","MID_RATE":"0.0032750","CNVR_OTSND_BAL":"38.276235000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.50000","EFF_INT_RATE_TP_ID":"","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0844x","AR_ID_ENCODED":"E7Eak3q4HFGMU8oNnECLBw==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"1101","AR_TERM":"0","AR_TERM_UOM_TP_CD":"","CCY_CD":"USD","CCY_OTSND_BAL":"778.01","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"25755.787647000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.00000","EFF_INT_RATE_TP_ID":"","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0845x","AR_ID_ENCODED":"lkw3lc5ZONz26q+1cgbaIg==","SUB_AR":"001","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"1","AR_TERM_UOM_TP_CD":"M","CCY_CD":"USD","CCY_OTSND_BAL":"0.00","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.07000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2018-04-05","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0835x","AR_ID_ENCODED":"X3/WKPnClsMBbPTViekFtQ==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"2101","AR_TERM":"0","AR_TERM_UOM_TP_CD":"","CCY_CD":"USD","CCY_OTSND_BAL":"0.00","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.14000","EFF_INT_RATE_TP_ID":"","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"},{"POS_DT":"2018-09-20","AR_ID":"xxxxx0847x","AR_ID_ENCODED":"QO4YiiG3eS2AuNNQceNRfw==","SUB_AR":"000","AR_NM":"MR. NIEMLEK NARUN","OPN_DT":"2018-03-05","CLS_DT":"","FCD_TP_CD":"DFCD","PD_TP_CD":"3101","AR_TERM":"99","AR_TERM_UOM_TP_CD":"Y","CCY_CD":"USD","CCY_OTSND_BAL":"0.00","MID_RATE":"33.1047000","CNVR_OTSND_BAL":"0.000000000","AR_LCS_TP_CD":"0","AR_OWN_TP_CD":"2","CCY_HLD_AMT":"0.00","EFF_INT_RATE":"0.00000","EFF_INT_RATE_TP_ID":"CDUSD","EFF_SPRD_INT_RATE":"","EFF_DT":"","MAT_DT":"2114-10-15","DOMC_BR_NO":"0011","DOMC_BR_NM":"สาขาสะพานเหลือง","SRC_STM_ID":"640"}]}}}}';
		return response;
	}
}